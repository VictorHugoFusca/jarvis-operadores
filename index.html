<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tabela Din√¢mica - Hor√°rios dos Operadores</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    th input {
      width: 100%;
      font-size: 0.9rem;
      padding: 4px;
      box-sizing: border-box;
    }
  </style>
</head>
<body class="bg-light">
<div class="container my-5">
  <h1 class="text-center mb-4">üìä Tabela Din√¢mica - Hor√°rios dos Operadores</h1>

  <div class="alert alert-info">
    <strong>‚ÑπÔ∏è Informa√ß√µes:</strong> Esta tabela apresenta os hor√°rios organizados por operador diretamente do JARVIS, incluindo in√≠cio e fim do almo√ßo e descansos.
  </div>

  <div class="mb-4">
    <textarea id="dadosInput" class="form-control mb-2" rows="6" placeholder="üìã Cole aqui os dados no formato: Nome Operador | Nome L√≠der | In√≠cio Conex√£o | Fim Conex√£o | In√≠cio Almo√ßo | Fim Almo√ßo | Descanso 1 | Descanso 2 | Status"></textarea>
    <button onclick="processarDados()" class="btn btn-success me-2">üìä Processar Dados</button>
    <button onclick="limparDados()" class="btn btn-danger me-2">üóëÔ∏è Limpar Dados</button>
    <button onclick="baixarExcel()" class="btn btn-primary">üì• Baixar Excel</button>
  </div>

  <div class="table-responsive">
    <table class="table table-bordered table-hover" id="tabelaOperadores">
      <thead class="table-light">
        <tr>
          <th>Operador<br><input type="text" onkeyup="filtrarTabela(0)" placeholder="Filtrar"></th>
          <th>L√≠der<br><input type="text" onkeyup="filtrarTabela(1)" placeholder="Filtrar"></th>
          <th>In√≠cio Conex√£o<br><input type="text" onkeyup="filtrarTabela(2)" placeholder="Filtrar"></th>
          <th>Fim Conex√£o<br><input type="text" onkeyup="filtrarTabela(3)" placeholder="Filtrar"></th>
          <th>In√≠cio Almo√ßo<br><input type="text" onkeyup="filtrarTabela(4)" placeholder="Filtrar"></th>
          <th>Fim Almo√ßo<br><input type="text" onkeyup="filtrarTabela(5)" placeholder="Filtrar"></th>
          <th>Descanso 1<br><input type="text" onkeyup="filtrarTabela(6)" placeholder="Filtrar"></th>
          <th>Descanso 2<br><input type="text" onkeyup="filtrarTabela(7)" placeholder="Filtrar"></th>
          <th>Status<br><input type="text" onkeyup="filtrarTabela(8)" placeholder="Filtrar"></th>
        </tr>
      </thead>
      <tbody id="corpoTabela">
        <tr><td colspan="9" class="text-center text-muted">Nenhum dado carregado.</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
let dados = [];

function processarDados() {
  const input = document.getElementById('dadosInput').value.trim();
  if (!input) return alert('Cole os dados primeiro.');

  dados = [];
  const linhas = input.split('\n').filter(l => l.trim() !== '');

  linhas.forEach(linha => {
    const partes = linha.split(/\t|\|/).map(s => s.trim());

    while (partes.length < 9) partes.push('');

    const [operador, lider, inicioConexao, fimConexao, inicioAlmoco, fimAlmoco, descanso1, descanso2, status] = partes;

    dados.push({
      operador,
      lider,
      inicioConexao,
      fimConexao,
      inicioAlmoco,
      fimAlmoco,
      descanso1,
      descanso2,
      status: status || 'Turno programado'
    });
  });

  carregarTabela();
  alert(`${dados.length} registros carregados.`);
}

function limparDados() {
  document.getElementById('dadosInput').value = '';
  dados = [];
  carregarTabela();
}

function carregarTabela() {
  const corpo = document.getElementById('corpoTabela');
  if (dados.length === 0) {
    corpo.innerHTML = '<tr><td colspan="9" class="text-center text-muted">Nenhum dado.</td></tr>';
    return;
  }

  corpo.innerHTML = dados.map(d => `
    <tr>
      <td>${d.operador}</td>
      <td>${d.lider}</td>
      <td>${d.inicioConexao}</td>
      <td>${d.fimConexao}</td>
      <td>${d.inicioAlmoco}</td>
      <td>${d.fimAlmoco}</td>
      <td>${d.descanso1}</td>
      <td>${d.descanso2}</td>
      <td>${d.status}</td>
    </tr>`).join('');
}

function filtrarTabela(coluna) {
  const input = document.querySelectorAll('thead input')[coluna];
  const filtro = input.value.toLowerCase();
  const tabela = document.getElementById("tabelaOperadores");
  const linhas = tabela.getElementsByTagName("tbody")[0].getElementsByTagName("tr");

  for (let i = 0; i < linhas.length; i++) {
    const celulas = linhas[i].getElementsByTagName("td");
    if (celulas.length > coluna) {
      const texto = celulas[coluna].textContent || celulas[coluna].innerText;
      linhas[i].style.display = texto.toLowerCase().indexOf(filtro) > -1 ? "" : "none";
    }
  }
}

function baixarExcel() {
  if (dados.length === 0) return alert('Nada para exportar.');
  const ws = XLSX.utils.json_to_sheet(dados);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Hor√°rios");
  XLSX.writeFile(wb, "horarios_operadores.xlsx");
}
</script>
</body>
</html>
